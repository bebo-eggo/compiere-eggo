CREATE TABLE "Z_TYPEOA" 
   (	"AD_CLIENT_ID" NUMBER(10,0) NOT NULL ENABLE, 
	"AD_ORG_ID" NUMBER(10,0) NOT NULL ENABLE, 
	"CREATED" DATE DEFAULT SYSDATE NOT NULL ENABLE, 
	"CREATEDBY" NUMBER(10,0) DEFAULT 0 NOT NULL ENABLE, 
	"DESCRIPTION" NVARCHAR2(255), 
	"ISACTIVE" CHAR(1 BYTE) DEFAULT 'Y' NOT NULL ENABLE, 
	"ISDEFAULT" CHAR(1 BYTE) DEFAULT 'N' NOT NULL ENABLE, 
	"NAME" NVARCHAR2(50) NOT NULL ENABLE, 
	"UPDATED" DATE DEFAULT SYSDATE NOT NULL ENABLE, 
	"UPDATEDBY" NUMBER(10,0) DEFAULT 0 NOT NULL ENABLE, 
	"VALUE" NVARCHAR2(20) NOT NULL ENABLE, 
	"Z_STATUSPLAN" CHAR(2 BYTE), 
	"Z_TYPEOA_ID" NUMBER(10,0) NOT NULL ENABLE, 
	 CHECK (IsActive IN ('Y','N')) ENABLE, 
	 CHECK (IsDefault IN ('Y','N')) ENABLE, 
	 CONSTRAINT "Z_TYPEOA_PK" PRIMARY KEY ("Z_TYPEOA_ID")),
	 CONSTRAINT "FK1007459X_1035924" FOREIGN KEY ("AD_CLIENT_ID")
	  REFERENCES "AD_CLIENT" ("AD_CLIENT_ID") ENABLE);
  CREATE TABLE "Z_TYPEOA_TRL" 
   (	"AD_CLIENT_ID" NUMBER(10,0) NOT NULL ENABLE, 
	"AD_LANGUAGE" VARCHAR2(10 BYTE) NOT NULL ENABLE, 
	"AD_ORG_ID" NUMBER(10,0) NOT NULL ENABLE, 
	"CREATED" DATE DEFAULT SYSDATE NOT NULL ENABLE, 
	"CREATEDBY" NUMBER(10,0) DEFAULT 0 NOT NULL ENABLE, 
	"ISACTIVE" CHAR(1 BYTE) DEFAULT 'Y' NOT NULL ENABLE, 
	"NAME" NVARCHAR2(50), 
	"UPDATED" DATE DEFAULT SYSDATE NOT NULL ENABLE, 
	"UPDATEDBY" NUMBER(10,0) DEFAULT 0 NOT NULL ENABLE, 
	"Z_TYPEOA_ID" NUMBER(10,0) NOT NULL ENABLE, 
	"ISTRANSLATED" CHAR(1 BYTE) DEFAULT 'N' NOT NULL ENABLE, 
	 CHECK (IsActive IN ('Y','N')) ENABLE, 
	 CONSTRAINT "PK1007460X" PRIMARY KEY ("AD_LANGUAGE", "Z_TYPEOA_ID"),
	 CHECK (IsTranslated IN ('Y','N')) ENABLE, 
	 CONSTRAINT "FK1007460X_1035941" FOREIGN KEY ("AD_CLIENT_ID")
	  REFERENCES "AD_CLIENT" ("AD_CLIENT_ID") ENABLE);
ALTER TABLE Z_S_S_Famille ADD Z_TypeOA_ID NUMBER(10);
ALTER TABLE C_Order ADD Z_TypeOA_ID NUMBER(10);
ALTER TABLE C_Order ADD Z_StatusPlan CHAR(2);
ALTER TABLE C_Order ADD Z_DatePlan DATE;
UPDATE AD_REF_TABLE set WHERECLAUSE = 'M_Product.IsSummary=''N'' 
AND 
( 
 ( (select o.issotrx from C_Order o where o.C_Order_ID = @C_Order_ID@) = ''Y'' AND M_Product.IsSold = ''Y'') 
 OR
 ( (select o.issotrx from C_Order o where o.C_Order_ID =  @C_Order_ID@) = ''N'' AND M_Product.IsPurchased = ''Y''  and exists (Select 1 from M_Product mp inner join Z_TYPEOA zt on zt.Z_TYPEOA_ID = @Z_TypeOA_ID@ left join Z_S_S_FAMILLE zssf on zssf.Z_S_S_FAMILLE_ID = mp.Z_S_S_FAMILLE_ID where ((zssf.Z_TYPEOA_ID = zt.Z_TYPEOA_ID and zt.ISDEFAULT = ''N'') OR ((zssf.Z_TYPEOA_ID = zt.Z_TYPEOA_ID OR zssf.Z_TYPEOA_ID is null) AND zt.ISDEFAULT = 'Y')) and mp.M_Product_ID = M_Product.M_Product_ID ) ) 
)'where AD_REFERENCE_ID = 1000364 and AD_TABLE_ID = 208 and COLUMNKEY_ID=	1402 and COLUMN_DISPLAY_ID=1410;